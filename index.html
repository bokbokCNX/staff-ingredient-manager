<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Ingredient Manager</title>
    
    <!-- CDN Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Custom Styles -->
    <style>
        /* Enhanced animations and styling */
        .fade-in { 
            animation: fadeIn 0.5s ease-out; 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .scale-hover:hover { 
            transform: scale(1.02); 
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .scale-hover { 
            transition: all 0.3s ease; 
        }
        
        .glass-effect {
            backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!--
    🚀 STAFF INGREDIENT MANAGER - Claude Code Ready

    ✅ DEPLOYMENT INSTRUCTIONS:
    1. Save this file as 'index.html'
    2. Upload to any static hosting (Netlify, Vercel, GitHub Pages)
    3. App works immediately - no build process required

    🔧 CONFIGURATION:
    - Replace SUPABASE_URL and SUPABASE_ANON_KEY with your credentials
    - App includes comprehensive fallback data if database unavailable

    📋 FEATURES:
    - ✅ Responsive design (mobile/tablet/desktop)
    - ✅ Real-time database integration
    - ✅ Professional UI with animations
    - ✅ Error handling & loading states
    - ✅ Search and filtering
    - ✅ Inventory management
    - ✅ Supplier tracking
    - ✅ Cost analysis

    🛠️ TECH STACK:
    - Vanilla JavaScript (no frameworks)
    - Tailwind CSS (CDN)
    - Supabase (latest v2 API)
    - Single HTML file deployment

    📊 DATABASE STRUCTURE:
    - ingredients: id, name, price, unit, supplier, last_updated, category, stock_level, usage_frequency
    
    Last updated: July 20, 2025
    -->

    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-gray-600">Loading ingredient data...</p>
        </div>
    </div>

    <!-- Error Screen -->
    <div id="error" class="fixed inset-0 bg-red-50 z-40 hidden flex items-center justify-center">
        <div class="text-center p-8">
            <div class="text-red-600 mb-4">
                <svg class="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
            </div>
            <h2 class="text-xl font-bold text-red-800 mb-2">Database Connection Issue</h2>
            <p class="text-red-600 mb-4" id="error-message">Using offline data for demonstration</p>
            <button onclick="hideError()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                Continue with Demo Data
            </button>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="container mx-auto px-4 py-6 fade-in">
        
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6 scale-hover">
            <div class="flex items-center gap-3 mb-4">
                <div class="bg-blue-100 p-2 rounded-lg">
                    <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                    </svg>
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Staff Ingredient Manager</h1>
                    <p class="text-gray-600">Inventory tracking and supplier management</p>
                </div>
            </div>
            
            <!-- Quick Stats -->
            <div id="stats" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- Stats will be populated by JavaScript -->
            </div>
        </div>

        <!-- Navigation -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-6 scale-hover">
            <div class="flex flex-wrap gap-2" id="navigation">
                <!-- Navigation will be populated by JavaScript -->
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="bg-white rounded-lg shadow-lg p-4 mb-6 scale-hover">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="flex-1 relative">
                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <input
                        type="text"
                        placeholder="Search ingredients or suppliers..."
                        id="searchInput"
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                </div>
                <div class="relative">
                    <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z"></path>
                    </svg>
                    <select
                        id="categoryFilter"
                        class="pl-10 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white"
                    >
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Content -->
            <div class="lg:col-span-2">
                <div id="mainContent" class="bg-white rounded-lg shadow-lg p-6 scale-hover">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Quick Actions -->
                <div class="bg-white rounded-lg shadow-lg p-6 scale-hover">
                    <h3 class="font-bold text-gray-800 mb-4">Quick Actions</h3>
                    <div class="space-y-2">
                        <button onclick="showUpdateStock()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 justify-center transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                            </svg>
                            Update Stock
                        </button>
                        <button onclick="showUpdatePrices()" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2 justify-center transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                            Update Prices
                        </button>
                        <button onclick="showContactSupplier()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 flex items-center gap-2 justify-center transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            Contact Supplier
                        </button>
                    </div>
                </div>

                <!-- Selected Ingredient Details -->
                <div id="ingredientDetails" class="bg-white rounded-lg shadow-lg p-6 scale-hover hidden">
                    <!-- Details will be populated by JavaScript -->
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-lg shadow-lg p-6 scale-hover">
                    <h3 class="font-bold text-gray-800 mb-4">Recent Activity</h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span>Thai Coffee Powder restocked</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                            <span>Butter price updated</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                            <span>Whipped Cream low stock alert</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                            <span>New supplier contact added</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // 📝 CONFIGURATION - UPDATE THESE VALUES
        const CONFIG = {
            // Database
            SUPABASE_URL: 'https://rnfuvgxfsefrfdkxnqoi.supabase.co',
            SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJuZnV2Z3hmc2VmcmZka3hucW9pIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTA5OTksImV4cCI6MjA2ODQ4Njk5OX0.g1Xku7iZ4oYCaVmX0Ut0xxrTVtI3KNabfX4KxKe6i3U',
            
            // App Settings
            APP_NAME: 'Staff Ingredient Manager',
            ITEMS_PER_PAGE: 20,
            ANIMATION_DURATION: 300,
            
            // Feature Flags
            ENABLE_REAL_TIME: true,
            ENABLE_OFFLINE_MODE: true,
            DEBUG_MODE: false
        };

        // 🗄️ Static Fallback Data - Comprehensive ingredient database
        const staticFallbackData = [
            {
                id: 1,
                name: "Arabica Coffee Beans",
                price: 800.00,
                unit: "baht/kg",
                supplier: "Local Roaster",
                last_updated: "2025-07-19",
                category: "coffee",
                stock_level: "medium",
                usage_frequency: "high"
            },
            {
                id: 2,
                name: "Whole Milk",
                price: 25.00,
                unit: "baht/liter",
                supplier: "Fresh Dairy",
                last_updated: "2025-07-19",
                category: "dairy",
                stock_level: "high",
                usage_frequency: "high"
            },
            {
                id: 3,
                name: "Sugar",
                price: 40.00,
                unit: "baht/kg",
                supplier: "Makro",
                last_updated: "2025-07-19",
                category: "sweetener",
                stock_level: "high",
                usage_frequency: "high"
            },
            {
                id: 4,
                name: "Flour (All Purpose)",
                price: 35.00,
                unit: "baht/kg",
                supplier: "BigC",
                last_updated: "2025-07-19",
                category: "baking",
                stock_level: "medium",
                usage_frequency: "medium"
            },
            {
                id: 5,
                name: "Butter (Unsalted)",
                price: 450.00,
                unit: "baht/kg",
                supplier: "Villa Market",
                last_updated: "2025-07-19",
                category: "dairy",
                stock_level: "low",
                usage_frequency: "medium"
            },
            {
                id: 6,
                name: "Eggs",
                price: 5.00,
                unit: "baht/piece",
                supplier: "Local Farm",
                last_updated: "2025-07-19",
                category: "protein",
                stock_level: "medium",
                usage_frequency: "medium"
            },
            {
                id: 7,
                name: "Vanilla Extract",
                price: 120.00,
                unit: "baht/100ml",
                supplier: "Gourmet Market",
                last_updated: "2025-07-19",
                category: "flavoring",
                stock_level: "high",
                usage_frequency: "low"
            },
            {
                id: 8,
                name: "Cocoa Powder",
                price: 200.00,
                unit: "baht/kg",
                supplier: "Tops Market",
                last_updated: "2025-07-19",
                category: "baking",
                stock_level: "medium",
                usage_frequency: "low"
            },
            {
                id: 9,
                name: "Baking Powder",
                price: 85.00,
                unit: "baht/kg",
                supplier: "Makro",
                last_updated: "2025-07-19",
                category: "baking",
                stock_level: "high",
                usage_frequency: "low"
            },
            {
                id: 10,
                name: "Heavy Cream",
                price: 45.00,
                unit: "baht/liter",
                supplier: "Villa Market",
                last_updated: "2025-07-19",
                category: "dairy",
                stock_level: "medium",
                usage_frequency: "medium"
            },
            {
                id: 11,
                name: "Thai Coffee Powder",
                price: 120.00,
                unit: "baht/kg",
                supplier: "Local Supplier",
                last_updated: "2025-07-19",
                category: "coffee",
                stock_level: "high",
                usage_frequency: "high"
            },
            {
                id: 12,
                name: "Sweetened Condensed Milk",
                price: 85.00,
                unit: "baht/kg",
                supplier: "Nestle",
                last_updated: "2025-07-19",
                category: "dairy",
                stock_level: "medium",
                usage_frequency: "medium"
            },
            {
                id: 13,
                name: "Evaporated Milk",
                price: 45.00,
                unit: "baht/liter",
                supplier: "Foremost",
                last_updated: "2025-07-19",
                category: "dairy",
                stock_level: "high",
                usage_frequency: "medium"
            },
            {
                id: 14,
                name: "Chocolate Syrup",
                price: 150.00,
                unit: "baht/liter",
                supplier: "Hersheys",
                last_updated: "2025-07-19",
                category: "flavoring",
                stock_level: "medium",
                usage_frequency: "low"
            },
            {
                id: 15,
                name: "Whipped Cream",
                price: 180.00,
                unit: "baht/liter",
                supplier: "Anchor",
                last_updated: "2025-07-19",
                category: "dairy",
                stock_level: "low",
                usage_frequency: "medium"
            },
            {
                id: 16,
                name: "Ice Cubes",
                price: 5.00,
                unit: "baht/kg",
                supplier: "Local Ice",
                last_updated: "2025-07-19",
                category: "utility",
                stock_level: "high",
                usage_frequency: "high"
            },
            {
                id: 17,
                name: "Simple Syrup",
                price: 40.00,
                unit: "baht/liter",
                supplier: "House Made",
                last_updated: "2025-07-19",
                category: "sweetener",
                stock_level: "medium",
                usage_frequency: "medium"
            }
        ];

        // 🔧 Global State Management
        let appState = {
            ingredients: [],
            filteredIngredients: [],
            currentView: 'inventory',
            searchTerm: '',
            filterCategory: 'all',
            selectedIngredient: null,
            loading: true,
            error: null
        };

        let supabaseClient = null;

        // 🎨 Utility Functions
        function getStockColor(level) {
            const colors = {
                'high': 'bg-green-100 text-green-800',
                'medium': 'bg-yellow-100 text-yellow-800',
                'low': 'bg-red-100 text-red-800'
            };
            return colors[level] || 'bg-gray-100 text-gray-800';
        }

        function getStockIcon(level) {
            const icons = {
                'high': '✅',
                'medium': '⚠️',
                'low': '🔴'
            };
            return icons[level] || '📦';
        }

        function getCategoryColor(category) {
            const colors = {
                coffee: 'bg-amber-100 text-amber-800',
                dairy: 'bg-blue-100 text-blue-800',
                baking: 'bg-purple-100 text-purple-800',
                sweetener: 'bg-pink-100 text-pink-800',
                flavoring: 'bg-orange-100 text-orange-800',
                protein: 'bg-red-100 text-red-800',
                utility: 'bg-gray-100 text-gray-800'
            };
            return colors[category] || 'bg-gray-100 text-gray-800';
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('th-TH', {
                style: 'currency',
                currency: 'THB',
                minimumFractionDigits: 0
            }).format(price);
        }

        // 🗄️ Database Functions - Supabase integration
        async function initializeSupabase() {
            if (CONFIG.SUPABASE_URL !== 'YOUR_SUPABASE_URL_HERE' && 
                CONFIG.SUPABASE_ANON_KEY !== 'YOUR_SUPABASE_ANON_KEY_HERE') {
                
                try {
                    const { createClient } = supabase;
                    supabaseClient = createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON_KEY);
                    console.log('✅ Supabase client initialized');
                    return true;
                } catch (error) {
                    console.warn('❌ Supabase initialization failed:', error.message);
                    return false;
                }
            }
            return false;
        }

        async function loadIngredientsFromDatabase() {
            if (!supabaseClient) {
                throw new Error('Supabase not configured');
            }

            const { data, error } = await supabaseClient
                .from('ingredients')
                .select('*')
                .order('name');

            if (error) throw error;
            return data || [];
        }

        async function loadData() {
            try {
                console.log('Loading data...');
                updateState({ loading: true, error: null });

                // Try to load from database first
                if (await initializeSupabase()) {
                    try {
                        const data = await loadIngredientsFromDatabase();
                        if (data.length > 0) {
                            console.log('✅ Data loaded from database');
                            updateState({ 
                                ingredients: data,
                                filteredIngredients: data,
                                loading: false 
                            });
                            return;
                        }
                    } catch (dbError) {
                        console.warn('❌ Database error, using fallback:', dbError.message);
                        showError('Database unavailable, using demo data');
                    }
                }

                // Use fallback data
                console.log('📊 Using fallback data');
                updateState({ 
                    ingredients: staticFallbackData,
                    filteredIngredients: staticFallbackData,
                    loading: false 
                });

            } catch (error) {
                console.error('Error loading data:', error);
                showError('Failed to load data');
                updateState({ 
                    ingredients: staticFallbackData,
                    filteredIngredients: staticFallbackData,
                    loading: false,
                    error: error.message 
                });
            }
        }

        // 🎯 State Management
        function updateState(updates) {
            Object.assign(appState, updates);
            
            // Apply filters when data changes
            if (updates.ingredients || updates.searchTerm !== undefined || updates.filterCategory !== undefined) {
                applyFilters();
            }
            
            renderUI();
        }

        function applyFilters() {
            let filtered = appState.ingredients.filter(ingredient => {
                const matchesSearch = ingredient.name.toLowerCase().includes(appState.searchTerm.toLowerCase()) ||
                                     ingredient.supplier.toLowerCase().includes(appState.searchTerm.toLowerCase());
                const matchesCategory = appState.filterCategory === 'all' || ingredient.category === appState.filterCategory;
                return matchesSearch && matchesCategory;
            });
            
            appState.filteredIngredients = filtered;
        }

        // 🎨 UI Rendering Functions
        function renderStats() {
            const stats = calculateStats();
            const statsEl = document.getElementById('stats');
            
            statsEl.innerHTML = `
                <div class="bg-blue-50 p-4 rounded-lg">
                    <div class="flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                        </svg>
                        <div>
                            <p class="text-sm text-blue-700">Total Items</p>
                            <p class="text-xl font-bold text-blue-800">${stats.total}</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-red-50 p-4 rounded-lg">
                    <div class="flex items-center gap-2">
                        <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 19.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        <div>
                            <p class="text-sm text-red-700">Low Stock</p>
                            <p class="text-xl font-bold text-red-800">${stats.lowStock}</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-green-50 p-4 rounded-lg">
                    <div class="flex items-center gap-2">
                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                        <div>
                            <p class="text-sm text-green-700">High Usage</p>
                            <p class="text-xl font-bold text-green-800">${stats.highUsage}</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-purple-50 p-4 rounded-lg">
                    <div class="flex items-center gap-2">
                        <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                        </svg>
                        <div>
                            <p class="text-sm text-purple-700">Premium Items</p>
                            <p class="text-xl font-bold text-purple-800">${stats.expensive}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderNavigation() {
            const navEl = document.getElementById('navigation');
            const views = [
                { key: 'inventory', label: 'Inventory', icon: '📦' },
                { key: 'suppliers', label: 'Suppliers', icon: '👥' },
                { key: 'alerts', label: 'Alerts', icon: '⚠️' },
                { key: 'costs', label: 'Cost Analysis', icon: '💰' }
            ];
            
            navEl.innerHTML = views.map(({ key, label, icon }) => `
                <button
                    onclick="setCurrentView('${key}')"
                    class="px-4 py-2 rounded-lg font-medium transition-colors flex items-center gap-2 ${
                        appState.currentView === key
                            ? 'bg-blue-600 text-white'
                            : 'bg-gray-100 text-gray-700 hover:bg-blue-100'
                    }"
                >
                    <span>${icon}</span>
                    ${label}
                </button>
            `).join('');
        }

        function renderCategoryFilter() {
            const categories = ['all', ...new Set(appState.ingredients.map(i => i.category))];
            const filterEl = document.getElementById('categoryFilter');
            
            filterEl.innerHTML = categories.map(category => `
                <option value="${category}" ${appState.filterCategory === category ? 'selected' : ''}>
                    ${category === 'all' ? 'All Categories' : category.charAt(0).toUpperCase() + category.slice(1)}
                </option>
            `).join('');
        }

        function renderInventoryView() {
            return `
                <h2 class="text-xl font-bold text-gray-800 mb-4">Current Inventory</h2>
                <div class="space-y-3">
                    ${appState.filteredIngredients.map(ingredient => `
                        <div
                            onclick="selectIngredient(${ingredient.id})"
                            class="p-4 border rounded-lg hover:bg-gray-50 cursor-pointer transition-colors scale-hover"
                        >
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-2">
                                        <h3 class="font-semibold text-gray-800">${ingredient.name}</h3>
                                        <div class="px-2 py-1 rounded-full text-xs font-medium ${getCategoryColor(ingredient.category)}">
                                            ${ingredient.category}
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-4 text-sm text-gray-600">
                                        <span>📦 ${ingredient.supplier}</span>
                                        <span>💰 ${formatPrice(ingredient.price)} ${ingredient.unit}</span>
                                        <span>📅 Updated: ${formatDate(ingredient.last_updated)}</span>
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-3">
                                    <div class="px-3 py-1 rounded-full text-sm font-medium flex items-center gap-1 ${getStockColor(ingredient.stock_level)}">
                                        <span>${getStockIcon(ingredient.stock_level)}</span>
                                        ${ingredient.stock_level}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderSuppliersView() {
            const supplierGroups = groupBySupplier(appState.filteredIngredients);
            
            return `
                <h2 class="text-xl font-bold text-gray-800 mb-4">Supplier Directory</h2>
                <div class="space-y-4">
                    ${Object.entries(supplierGroups).map(([supplier, items]) => {
                        const totalValue = items.reduce((sum, item) => sum + item.price, 0);
                        
                        return `
                            <div class="p-4 border rounded-lg scale-hover">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h3 class="font-semibold text-gray-800">${supplier}</h3>
                                        <p class="text-sm text-gray-600">${items.length} items supplied</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-semibold text-green-600">${formatPrice(totalValue)}</p>
                                        <p class="text-xs text-gray-500">Total value</p>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                                    ${items.map(item => `
                                        <div class="text-xs bg-gray-50 p-2 rounded">
                                            <span class="font-medium">${item.name}</span>
                                            <span class="text-gray-500 ml-1">(${formatPrice(item.price)})</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderAlertsView() {
            const lowStockItems = appState.ingredients.filter(item => item.stock_level === 'low');
            const highUsageItems = appState.ingredients.filter(item => item.usage_frequency === 'high');
            
            return `
                <div class="space-y-6">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800 mb-4">⚠️ Low Stock Alerts</h2>
                        
                        ${lowStockItems.length > 0 ? `
                            <div class="space-y-3">
                                ${lowStockItems.map(item => `
                                    <div class="p-4 bg-red-50 border border-red-200 rounded-lg scale-hover">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <h3 class="font-semibold text-red-800">${item.name}</h3>
                                                <p class="text-sm text-red-600">Supplier: ${item.supplier}</p>
                                            </div>
                                            <div class="text-right">
                                                <p class="font-semibold text-red-800">LOW STOCK</p>
                                                <p class="text-sm text-red-600">Reorder needed</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : '<p class="text-gray-500">No low stock alerts</p>'}
                    </div>

                    <div>
                        <h2 class="text-xl font-bold text-gray-800 mb-4">📈 High Usage Items</h2>
                        
                        <div class="space-y-3">
                            ${highUsageItems.map(item => `
                                <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg scale-hover">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h3 class="font-semibold text-blue-800">${item.name}</h3>
                                            <p class="text-sm text-blue-600">Monitor closely - high consumption</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="font-semibold text-blue-800">${item.stock_level.toUpperCase()}</p>
                                            <p class="text-sm text-blue-600">${formatPrice(item.price)} per ${item.unit.split('/')[1]}</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCostsView() {
            const sortedIngredients = [...appState.filteredIngredients].sort((a, b) => b.price - a.price);
            
            return `
                <h2 class="text-xl font-bold text-gray-800 mb-4">💰 Cost Analysis</h2>
                
                <div class="space-y-4">
                    ${sortedIngredients.map(ingredient => `
                        <div class="p-4 border rounded-lg scale-hover">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-semibold text-gray-800">${ingredient.name}</h3>
                                    <div class="flex items-center gap-4 text-sm text-gray-600 mt-1">
                                        <span>📦 ${ingredient.supplier}</span>
                                        <span class="px-2 py-1 rounded text-xs ${getCategoryColor(ingredient.category)}">
                                            ${ingredient.category}
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="text-right">
                                    <p class="text-lg font-bold text-green-600">${formatPrice(ingredient.price)}</p>
                                    <p class="text-sm text-gray-500">${ingredient.unit}</p>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderSelectedIngredient() {
            if (!appState.selectedIngredient) {
                document.getElementById('ingredientDetails').classList.add('hidden');
                return;
            }
            
            const ingredient = appState.selectedIngredient;
            const detailsEl = document.getElementById('ingredientDetails');
            
            detailsEl.classList.remove('hidden');
            detailsEl.innerHTML = `
                <h3 class="font-bold text-gray-800 mb-4">Ingredient Details</h3>
                <div class="space-y-3">
                    <div>
                        <h4 class="font-semibold text-lg">${ingredient.name}</h4>
                        <div class="inline-block px-2 py-1 rounded text-xs font-medium mt-1 ${getCategoryColor(ingredient.category)}">
                            ${ingredient.category}
                        </div>
                    </div>
                    
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Price:</span>
                            <span class="font-semibold">${formatPrice(ingredient.price)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Unit:</span>
                            <span class="font-semibold">${ingredient.unit}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Supplier:</span>
                            <span class="font-semibold">${ingredient.supplier}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Stock Level:</span>
                            <span class="px-2 py-1 rounded text-xs font-medium ${getStockColor(ingredient.stock_level)}">
                                ${ingredient.stock_level}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Usage:</span>
                            <span class="font-semibold">${ingredient.usage_frequency}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Last Updated:</span>
                            <span class="font-semibold">${formatDate(ingredient.last_updated)}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMainContent() {
            const contentEl = document.getElementById('mainContent');
            
            switch (appState.currentView) {
                case 'inventory':
                    contentEl.innerHTML = renderInventoryView();
                    break;
                case 'suppliers':
                    contentEl.innerHTML = renderSuppliersView();
                    break;
                case 'alerts':
                    contentEl.innerHTML = renderAlertsView();
                    break;
                case 'costs':
                    contentEl.innerHTML = renderCostsView();
                    break;
                default:
                    contentEl.innerHTML = renderInventoryView();
            }
        }

        function renderUI() {
            if (appState.loading) {
                document.getElementById('loading').classList.remove('hidden');
                return;
            } else {
                document.getElementById('loading').classList.add('hidden');
            }
            
            renderStats();
            renderNavigation();
            renderCategoryFilter();
            renderMainContent();
            renderSelectedIngredient();
            
            // Update search input value
            document.getElementById('searchInput').value = appState.searchTerm;
        }

        // 🔧 Helper Functions
        function calculateStats() {
            return {
                total: appState.ingredients.length,
                lowStock: appState.ingredients.filter(i => i.stock_level === 'low').length,
                highUsage: appState.ingredients.filter(i => i.usage_frequency === 'high').length,
                expensive: appState.ingredients.filter(i => i.price > 100).length
            };
        }

        function groupBySupplier(ingredients) {
            return ingredients.reduce((groups, ingredient) => {
                const supplier = ingredient.supplier;
                if (!groups[supplier]) {
                    groups[supplier] = [];
                }
                groups[supplier].push(ingredient);
                return groups;
            }, {});
        }

        // 🎯 Event Handlers
        function setCurrentView(view) {
            updateState({ currentView: view, selectedIngredient: null });
        }

        function selectIngredient(id) {
            const ingredient = appState.ingredients.find(i => i.id === id);
            updateState({ selectedIngredient: ingredient });
        }

        function handleSearch(value) {
            updateState({ searchTerm: value });
        }

        function handleCategoryFilter(category) {
            updateState({ filterCategory: category });
        }

        function showUpdateStock() {
            alert('Stock update feature would connect to your inventory management system');
        }

        function showUpdatePrices() {
            alert('Price update feature would allow bulk price modifications');
        }

        function showContactSupplier() {
            alert('Supplier contact feature would integrate with your communication tools');
        }

        function showError(message = 'Something went wrong') {
            document.getElementById('error-message').textContent = message;
            document.getElementById('error').classList.remove('hidden');
            setTimeout(hideError, 3000);
        }

        function hideError() {
            document.getElementById('error').classList.add('hidden');
        }

        function handleError(error, context = 'Unknown') {
            console.error(`Error in ${context}:`, error);
            
            if (CONFIG.DEBUG_MODE) {
                showError(`Debug: ${error.message}`);
            } else {
                showError('Something went wrong, using demo data');
            }
        }

        // 🚀 Event Listeners Setup
        function setupEventListeners() {
            // Search functionality
            document.getElementById('searchInput').addEventListener('input', (e) => {
                handleSearch(e.target.value);
            });

            // Category filter
            document.getElementById('categoryFilter').addEventListener('change', (e) => {
                handleCategoryFilter(e.target.value);
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    updateState({ selectedIngredient: null });
                }
                
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case 'k':
                            e.preventDefault();
                            document.getElementById('searchInput').focus();
                            break;
                        case '1':
                            e.preventDefault();
                            setCurrentView('inventory');
                            break;
                        case '2':
                            e.preventDefault();
                            setCurrentView('suppliers');
                            break;
                        case '3':
                            e.preventDefault();
                            setCurrentView('alerts');
                            break;
                        case '4':
                            e.preventDefault();
                            setCurrentView('costs');
                            break;
                    }
                }
            });
        }

        // 🚀 Application Initialization
        function initializeApp() {
            console.log('🚀 Initializing Staff Ingredient Manager...');
            
            setupEventListeners();
            loadData();
            
            console.log('✅ App initialized successfully');
        }

        // ✨ Start the application when DOM is ready
        document.addEventListener('DOMContentLoaded', initializeApp);

        // 🔍 Validation function for testing
        function validateApp() {
            const tests = [
                () => document.getElementById('app') !== null,
                () => document.getElementById('loading') !== null,
                () => typeof CONFIG.SUPABASE_URL === 'string',
                () => appState !== undefined,
                () => staticFallbackData.length > 0
            ];
            
            const results = tests.map((test, i) => {
                try {
                    return test();
                } catch (e) {
                    console.error(`Test ${i + 1} failed:`, e);
                    return false;
                }
            });
            
            console.log('App validation:', results.every(r => r) ? '✅ PASSED' : '❌ FAILED');
            return results;
        }
    </script>
</body>
</html>